---
title: "Predr_Cors"
author: "Author"
date: "`r Sys.Date()`"
output: html_document
---
```{r cpkgs, tab.cap='Framework software to help implement TIMELY standards', tab.id = 'cpkgs', echo = F, results = 'asis'}
      df <- tibble::tibble(Package = c("ready4",
                                       "ready4fun",
                                       "ready4class",
                                       "ready4pack",
                                       "ready4use",
                                       "ready4show"),
                           # Version = Package %>%
                           #   purrr::map_chr(~utils::packageDescription(.x) %>%
                           #                    purrr::pluck("Version")),
                           Focus = c("Syntax",
                                     "Modules",
                                     "Functions",
                                     "Libraries",
                                     "Data",
                                     "Reporting"),
                           `T` = c("3","2-3","2-3","1","1-2","2,4,6"), 
                           I = c("","4","","1-3","",""),
                           M = c("3","","2","1-2","1",""),
                           E = c("", "1","1-2","1","3",""),
                           L = c("","","","1,3","2-3",""),
                           Y = c("","","","","","1-2"),
                           `Depends on` = Package %>%
                             purrr::map(~ {
                               utils::packageDescription(.x) %>%
                                 `[`(c("Depends", "Imports")) %>%
                                 purrr::map(~{
                                   if(is.null(.x)){
                                     character(0)
                                     }else{
                                       .x %>%
                                         strsplit(",\\n") %>%
                                         purrr::flatten_chr() %>%
                                         purrr::map(~strsplit(.x,", ") %>%
                                                      purrr::flatten_chr()) %>%
                                         purrr::flatten_chr() %>% sort() %>%
                                         purrr::discard(~startsWith(.x,"R "))
                                       }
                                   }) %>%
                                 purrr::flatten_chr() %>%
                                 unique() %>%
                                 sort() %>%
                                 purrr::map_chr(~{
                                   updated_1L_chr <- stringr::str_replace_all(.x,"\\n"," ")
                                   problem_idx_1L_chr <- stringr::str_locate(updated_1L_chr," ")[1,1] %>%
                                     unname()
                                   if(!is.na(problem_idx_1L_chr))
                                     updated_1L_chr <- updated_1L_chr %>%
                                     stringr::str_sub(end = problem_idx_1L_chr-1)
                                   updated_1L_chr %>% 
                                     trimws(which = "left") 
                                   })
                               }) %>% 
                             purrr::map_chr (~ .x %>% paste0(collapse = " "))) %>% 
  as.data.frame() 
    df$Ref <- c("@ready42022",
                    "@ready4fun2022",
                    "@ready4class2022",
                    "@ready4pack2022",
                    "@ready4use2022",
                    "@ready4show2022")
df <- df %>%
  dplyr::mutate(Standard = purrr::pmap_chr(df,
                                           ~paste0("T",
                                                  ..3,
                                                  paste0(rep("&nbsp;",
                                                      1+max(nchar(df[,3]))-nchar(..3)),
                                                      collapse = ""#
                                                      ),
                                                  ifelse(..4=="","","I"),
                                                  ..4,
                                                  paste0(rep("&nbsp;",
                                                      1+max(nchar(df[,4]))-nchar(..4)),
                                                      collapse = ""#
                                                      ),
                                                  ifelse(..5=="","","M"),
                                                  ..5,
                                                  paste0(rep("&nbsp;",
                                                      1+max(nchar(df[,5]))-nchar(..5)),
                                                      collapse = ""#
                                                      ),
                                                  ifelse(..6=="","","E"),
                                                  ..6,
                                                  paste0(rep("&nbsp;",
                                                      1+max(nchar(df[,6]))-nchar(..6)),
                                                      collapse = ""#
                                                      ),
                                                  ifelse(..7=="","","L"),
                                                  ..7,
                                                  paste0(rep("&nbsp;",
                                                      1+max(nchar(df[,7]))-nchar(..7)),
                                                      collapse = ""#
                                                      ),
                                                  ifelse(..8=="","","&nbsp; &nbsp; &nbsp; &nbsp; Y"),
                                                  ..8,
                                                  paste0(rep("&nbsp;",
                                                      1+max(nchar(df[,8]))-nchar(..8)),
                                                      collapse = ""#
                                                      )))) %>%
  
  dplyr::select(Package,
                Ref,
                Focus,
                Standard,
                `Depends on`) 
names_chr <- names(df)
df <- data.frame(df[,1],
                 rep("&nbsp; &nbsp; &nbsp;",nrow(df)),
                 df[,2:3],
                 rep("&nbsp; &nbsp; &nbsp;",nrow(df)),
                 df[,4],
                 #rep("&nbsp; &nbsp; &nbsp;",nrow(df)),
                 df[,5])
colnames(df) <- c("Package"," ","Ref", "Focus", " ","Standard     ",# " ",
                  "Depends on")
if(params$X@outp_formats_chr[1] == "Word") {
  df %>%
    ready4show::print_table(output_type_1L_chr = params$X@outp_formats_chr[1],
                            caption_1L_chr = knitr::opts_current$get("tab.cap"),
                            mkdn_tbl_ref_1L_chr = paste0("tab:",knitr::opts_current$get("tab.id")),
                            use_rdocx_1L_lgl = ifelse(params$X@outp_formats_chr[1]=="Word",T,F),
                            add_to_row_ls = NULL,
                            sanitize_fn = NULL)
  }else{
    df %>%
    kableExtra::kbl(format = "markdown",
                      escape = F,
                    caption = knitr::opts_current$get("tab.cap"))
    # df %>%
    #   kableExtra::kbl(booktabs = T,
    #                   caption = knitr::opts_current$get("tab.cap")) %>%
    #   kableExtra::kable_styling(full_width = F) %>%
    #   kableExtra::column_spec(9, width = "17em") %>%
    #   kableExtra::add_header_above(c(" " = 2, "Supports standard" = 6, " "))
    }
```